[gd_resource type="Resource" load_steps=4 format=3 uid="uid://df48prjxgqto1"]

[ext_resource type="Texture2D" uid="uid://dw0wtiicqn6gw" path="res://assets/sprites/dagger.png" id="1_vm2jp"]
[ext_resource type="AudioStream" uid="uid://ts423b3gvpso" path="res://assets/sound/axe.ogg" id="2_gc8t4"]

[sub_resource type="GDScript" id="GDScript_i2rpd"]
script/source = "extends CardData

const FEAR = preload(\"uid://t28wluftr7m\")

@export var damage := 20

func apply_effects(targets: Array[Node], modifiers: ModifierHandler) -> void:
	if not Events.enemy_died.is_connected(_on_enemy_died):
		Events.enemy_died.connect(_on_enemy_died, CONNECT_ONE_SHOT)
	var modified_damage := modifiers.get_modified_value(damage, Modifier.Type.DMG_DEALT)
	Apply.damage(targets, modified_damage)
	Apply.fatality_candidates = [targets[0], self]
	SFXPlayer.play(sfx)

func get_default_description() -> String:
	return description % damage
	
func get_updated_description(hero_modifiers: ModifierHandler, enemy_modifiers: ModifierHandler) -> String:
	var modified_damage := hero_modifiers.get_modified_value(damage, Modifier.Type.DMG_DEALT)
	if enemy_modifiers:
		modified_damage = enemy_modifiers.get_modified_value(modified_damage, Modifier.Type.DMG_TAKEN)
	return description % modified_damage

func _on_enemy_died(enemy: Enemy) -> void:
	if Apply.fatality_candidates.has(enemy) and Apply.fatality_candidates.has(self):
		Apply.mood(enemies, FEAR, 1)
"

[resource]
script = SubResource("GDScript_i2rpd")
name = "Impale"
rarity = 1
art = ExtResource("1_vm2jp")
description = "Deal %s damage.
If fatal, apply 1 Fear to ALL enemies.
Forget."
sfx = ExtResource("2_gc8t4")
cost = 2
forget = true
